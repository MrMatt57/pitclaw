<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#f59e0b">
  <meta name="description" content="Pit Claw Temperature Controller">
  <link rel="manifest" href="/manifest.json">
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">
  <link rel="apple-touch-icon" href="/favicon.svg">
  <title>Pit Claw</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/uplot@1.6.31/dist/uPlot.min.css">
  <link rel="stylesheet" href="/style.css">
</head>
<body>
  <!-- Header Banner -->
  <header class="header-banner">
    <div class="header-left">
      <svg class="app-logo" viewBox="0 0 40 40" width="32" height="32" xmlns="http://www.w3.org/2000/svg">
        <circle cx="20" cy="20" r="19" fill="#1a1a2e" stroke="#f59e0b" stroke-width="2"/>
        <g fill="none" stroke="#f59e0b" stroke-width="1.2" opacity="0.4" stroke-linecap="round">
          <path d="M15 9 C14 7 16 5.5 15 4"/>
          <path d="M20 8 C19 6 21 4.5 20 3"/>
          <path d="M25 9 C24 7 26 5.5 25 4"/>
        </g>
        <g stroke="#ef4444" fill="#ef4444">
          <line x1="15" y1="18" x2="9" y2="10" stroke-width="3" stroke-linecap="round"/>
          <line x1="9" y1="10" x2="7" y2="6.5" stroke-width="2" stroke-linecap="round"/>
          <line x1="9" y1="10" x2="6" y2="10.5" stroke-width="2" stroke-linecap="round"/>
          <line x1="25" y1="18" x2="31" y2="10" stroke-width="3" stroke-linecap="round"/>
          <line x1="31" y1="10" x2="33" y2="6.5" stroke-width="2" stroke-linecap="round"/>
          <line x1="31" y1="10" x2="34" y2="10.5" stroke-width="2" stroke-linecap="round"/>
          <ellipse cx="20" cy="20" rx="6" ry="4" stroke="none"/>
          <rect x="16" y="23.5" width="8" height="3.5" rx="2" stroke="none"/>
          <path d="M16 26.5 L13 31 L17 29 L20 32.5 L23 29 L27 31 L24 26.5Z" stroke="none"/>
          <circle cx="17.5" cy="19" r="1.1" fill="#1a1a2e" stroke="none"/>
          <circle cx="22.5" cy="19" r="1.1" fill="#1a1a2e" stroke="none"/>
        </g>
      </svg>
      <h1 class="app-title">PIT CLAW</h1>
    </div>
    <div class="header-center">
      <div class="time-block">
        <span class="time-label">Start</span>
        <span class="time-val" id="cookStart">--:--</span>
      </div>
      <div class="time-block">
        <span class="time-label">Elapsed</span>
        <span class="time-val time-val-accent" id="cookTimer">00:00:00</span>
      </div>
      <div class="time-block">
        <span class="time-label">Done</span>
        <span class="time-val" id="cookDone">--:--</span>
      </div>
    </div>
    <div class="header-right">
      <svg class="wifi-icon" id="wifiIcon" viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
        <path d="M1 9l2 2c4.97-4.97 13.03-4.97 18 0l2-2C16.93 2.93 7.08 2.93 1 9zm8 8l3 3 3-3c-1.65-1.66-4.34-1.66-6 0zm-4-4l2 2c2.76-2.76 7.24-2.76 10 0l2-2C15.14 9.14 8.87 9.14 5 13z"/>
      </svg>
      <button class="icon-btn" id="btnNotify" aria-label="Toggle notifications">
        <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
          <path d="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.9 2 2 2zm6-6v-5c0-3.07-1.63-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.64 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2z"/>
        </svg>
      </button>
      <button class="icon-btn" id="btnSettings" aria-label="Settings">
        <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
          <path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58a.49.49 0 00.12-.61l-1.92-3.32a.49.49 0 00-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54a.48.48 0 00-.48-.41h-3.84a.48.48 0 00-.48.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96a.49.49 0 00-.59.22L2.74 8.87a.48.48 0 00.12.61l2.03 1.58c-.05.3-.07.62-.07.94s.02.64.07.94l-2.03 1.58a.49.49 0 00-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.26.41.48.41h3.84c.24 0 .44-.17.48-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6A3.6 3.6 0 1112 8.4a3.6 3.6 0 010 7.2z"/>
        </svg>
      </button>
    </div>
  </header>

  <!-- Update Banner -->
  <div class="update-banner" id="updateBanner" style="display:none">
    <span id="updateMessage">Update available</span>
    <button class="btn btn-primary btn-sm" id="btnUpdate">Update Now</button>
    <button class="icon-btn btn-dismiss" id="btnDismissUpdate" aria-label="Dismiss">
      <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
        <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
      </svg>
    </button>
  </div>

  <main class="dashboard">
    <!-- Output Bars (Fan / Damper) -->
    <section class="output-bars">
      <div class="output-bar-row" id="fanBarRow">
        <span class="output-bar-label fan-label">Fan</span>
        <div class="output-bar-track">
          <div class="output-bar fan-bar" id="fanBar" style="width: 0%"></div>
        </div>
        <span class="output-bar-value" id="fanBarValue">0%</span>
      </div>
      <div class="output-bar-row" id="damperBarRow">
        <span class="output-bar-label damper-label">Damper</span>
        <div class="output-bar-track">
          <div class="output-bar damper-bar" id="damperBar" style="width: 0%"></div>
        </div>
        <span class="output-bar-value" id="damperBarValue">0%</span>
      </div>
    </section>

    <!-- Temperature Cards Row -->
    <section class="temp-cards">
      <!-- Pit Temperature Card -->
      <div class="card temp-card pit-card">
        <div class="card-header">
          <span class="probe-label">Pit</span>
          <span class="probe-icon">&#x1F525;</span>
        </div>
        <div class="temp-display">
          <span class="temp-value" id="pitTemp">---</span>
          <span class="temp-unit">&deg;F</span>
        </div>
        <div class="setpoint-display">
          <span class="setpoint-label">Setpoint:</span>
          <span class="setpoint-value" id="pitSetpoint">---</span>
          <span class="temp-unit">&deg;F</span>
        </div>
        <div class="predicted-done" id="pitPrediction"></div>
      </div>

      <!-- Meat 1 Temperature Card -->
      <div class="card temp-card meat1-card">
        <div class="card-header">
          <span class="probe-label">Meat 1</span>
          <span class="probe-icon">&#x1F969;</span>
        </div>
        <div class="temp-display">
          <span class="temp-value" id="meat1Temp">---</span>
          <span class="temp-unit">&deg;F</span>
        </div>
        <div class="setpoint-display">
          <span class="setpoint-label">Target:</span>
          <span class="setpoint-value" id="meat1Target">---</span>
          <span class="temp-unit">&deg;F</span>
        </div>
        <div class="predicted-done" id="meat1Prediction"></div>
      </div>

      <!-- Meat 2 Temperature Card -->
      <div class="card temp-card meat2-card">
        <div class="card-header">
          <span class="probe-label">Meat 2</span>
          <span class="probe-icon">&#x1F969;</span>
        </div>
        <div class="temp-display">
          <span class="temp-value" id="meat2Temp">---</span>
          <span class="temp-unit">&deg;F</span>
        </div>
        <div class="setpoint-display">
          <span class="setpoint-label">Target:</span>
          <span class="setpoint-value" id="meat2Target">---</span>
          <span class="temp-unit">&deg;F</span>
        </div>
        <div class="predicted-done" id="meat2Prediction"></div>
      </div>
    </section>

    <!-- Chart -->
    <section class="chart-section">
      <div class="card chart-card">
        <div class="chart-header">
          <h2 class="chart-title">Temperature History</h2>
        </div>
        <div id="chartContainer" class="chart-container"></div>
        <div class="chart-legend">
          <span class="legend-outputs">
            <span class="legend-item legend-c-fan" data-series="4"><span class="legend-swatch"></span>Fan <span id="legFan">--</span></span>
            <span class="legend-item legend-c-damper" data-series="5"><span class="legend-swatch"></span>Damper <span id="legDamper">--</span></span>
          </span>
          <span class="legend-item legend-c-pit" data-series="1"><span class="legend-swatch"></span>Pit <span id="legPit">--</span></span>
          <span class="legend-item legend-c-meat1" data-series="2"><span class="legend-swatch"></span>Meat 1 <span id="legMeat1">--</span></span>
          <span class="legend-item legend-c-meat2" data-series="3"><span class="legend-swatch"></span>Meat 2 <span id="legMeat2">--</span></span>
          <span class="legend-time" id="legTime">--:--</span>
          <span class="legend-item legend-tgt legend-c-pit" data-series="6"><span class="legend-swatch legend-swatch-dash"></span>SP <span id="legSP">--</span></span>
          <span class="legend-item legend-tgt legend-c-meat1" data-series="7"><span class="legend-swatch legend-swatch-dash"></span>Tgt <span id="legM1Tgt">--</span></span>
          <span class="legend-item legend-tgt legend-c-meat2" data-series="8"><span class="legend-swatch legend-swatch-dash"></span>Tgt <span id="legM2Tgt">--</span></span>
        </div>
      </div>
    </section>
  </main>

  <!-- Footer -->
  <footer class="app-footer">
    <span id="fwVersion">Pit Claw</span>
  </footer>

  <!-- Update Progress Overlay -->
  <div class="update-overlay" id="updateOverlay" style="display:none">
    <div class="update-progress">
      <h3>Updating Firmware</h3>
      <div class="progress-bar"><div class="progress-fill" id="updateProgress"></div></div>
      <span id="updateStatus">Downloading...</span>
    </div>
  </div>

  <!-- Settings Panel -->
  <div class="settings-overlay" id="settingsOverlay"></div>
  <aside class="settings-panel" id="settingsPanel">
    <div class="settings-header">
      <h2>Settings</h2>
      <button class="icon-btn" id="btnCloseSettings" aria-label="Close settings">
        <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
          <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
        </svg>
      </button>
    </div>
    <div class="settings-body">
      <div class="settings-group">
        <div class="settings-label">Pit Setpoint</div>
        <div class="temp-control temp-control-lg">
          <button class="btn btn-adjust btn-adjust-lg" id="pitSpDown" aria-label="Decrease setpoint by 5">-5</button>
          <div class="temp-control-display">
            <input type="number" class="temp-control-input temp-control-input-lg" id="pitSpInput" min="100" max="500" step="5" value="225">
            <span class="temp-control-unit">&deg;F</span>
          </div>
          <button class="btn btn-adjust btn-adjust-lg" id="pitSpUp" aria-label="Increase setpoint by 5">+5</button>
        </div>
      </div>
      <div class="settings-divider"></div>
      <div class="settings-group">
        <div class="settings-label">Meat 1 Target</div>
        <div class="temp-control">
          <button class="btn btn-adjust" id="meat1TargetDown" aria-label="Decrease target by 5">-5</button>
          <div class="temp-control-display">
            <input type="number" class="temp-control-input" id="meat1TargetInput" min="100" max="212" step="5" placeholder="---">
            <span class="temp-control-unit">&deg;F</span>
          </div>
          <button class="btn btn-adjust" id="meat1TargetUp" aria-label="Increase target by 5">+5</button>
        </div>
      </div>
      <div class="settings-group">
        <div class="settings-label">Meat 2 Target</div>
        <div class="temp-control">
          <button class="btn btn-adjust" id="meat2TargetDown" aria-label="Decrease target by 5">-5</button>
          <div class="temp-control-display">
            <input type="number" class="temp-control-input" id="meat2TargetInput" min="100" max="212" step="5" placeholder="---">
            <span class="temp-control-unit">&deg;F</span>
          </div>
          <button class="btn btn-adjust" id="meat2TargetUp" aria-label="Increase target by 5">+5</button>
        </div>
      </div>
      <div class="settings-divider"></div>
      <div class="settings-group">
        <div class="settings-label">Fan Mode</div>
        <div class="fan-mode-buttons">
          <button class="btn btn-fan-mode" id="btnFanOnly" data-mode="fan_only">Fan Only</button>
          <button class="btn btn-fan-mode active" id="btnFanAndDamper" data-mode="fan_and_damper">Fan + Damper</button>
          <button class="btn btn-fan-mode" id="btnDamperPrimary" data-mode="damper_primary">Damper Primary</button>
        </div>
      </div>
      <div class="settings-divider"></div>
      <div class="settings-group">
        <div class="settings-label">Session</div>
        <div class="session-buttons">
          <button class="btn btn-secondary" id="btnDownloadCSV">Download CSV</button>
          <button class="btn btn-danger-outline" id="btnNewSession">New Session</button>
        </div>
      </div>
      <div class="settings-divider"></div>
      <div class="settings-group">
        <div class="settings-label">Display</div>
        <div class="prefs-row">
          <button class="btn btn-toggle" id="btnToggleUnits" title="Toggle &deg;F / &deg;C">&deg;F</button>
          <button class="btn btn-toggle" id="btnToggleTime" title="Toggle 12h / 24h">12h</button>
        </div>
      </div>
      <div class="settings-divider"></div>
      <div class="settings-group">
        <div class="settings-label">Firmware</div>
        <div class="firmware-info">
          <span id="settingsVersion">v---</span>
          <button class="btn btn-secondary" id="btnCheckUpdate">Check for Update</button>
        </div>
      </div>
    </div>
  </aside>

  <script src="https://cdn.jsdelivr.net/npm/uplot@1.6.31/dist/uPlot.iife.min.js"></script>
  <script src="/app.js"></script>
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/sw.js').catch(function(err) {
        console.warn('Service worker registration failed:', err);
      });
    }
  </script>
</body>
</html>
